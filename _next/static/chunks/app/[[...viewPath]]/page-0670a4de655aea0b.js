(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[733],{8960:function(e,n,t){Promise.resolve().then(t.bind(t,9580)),Promise.resolve().then(t.bind(t,16)),Promise.resolve().then(t.bind(t,5804)),Promise.resolve().then(t.bind(t,8601))},9580:function(e,n,t){"use strict";t.d(n,{AddComponentModalButton:function(){return g}});var l=t(7437),i=t(2265),a=t(2731),r=t(6648),o=t(5175),s=t(2151),d=t(6987),c=t(6463),u=t(8199),h=t(973);let p=[{value:"SectionUnit",label:"Section"},{value:"PlainTextUnit",label:"Plain Text"},{value:"MarkdownUnit",label:"Markdown"},{value:"AlertUnit",label:"Alert"},{value:"LinkUnit",label:"Link"},{value:"ImageMedia",label:"Image"},{value:"VideoMedia",label:"Video"},{value:"PDFMedia",label:"PDF"},{value:"ExperienceComponent",label:"Experience"},{value:"StyleContainer",label:"Style Container"},{value:"Mirror",label:"Mirror Existing"}];function v(e){var n,t,v,m;let{parentNodeId:f,submitLabel:g="Add component",submitClassName:x="button",onAdded:j}=e,b=(0,c.useRouter)(),[y,S]=(0,i.useState)("SectionUnit"),[w,k]=(0,i.useState)({}),[C,N]=(0,i.useState)(!1),[_,M]=(0,i.useState)(!1),[U,E]=(0,i.useState)(null),[P,T]=(0,i.useState)(""),[D,L]=(0,i.useState)(""),[I,F]=(0,i.useState)("internal"),[A,O]=(0,i.useState)([]),[V,R]=(0,i.useState)(null),[z,B]=(0,i.useState)([]),[J,W]=(0,i.useState)(null),[G,H]=(0,i.useState)(!1),[K,Q]=(0,i.useState)([]),[X,Y]=(0,i.useState)(null),[Z,q]=(0,i.useState)([]),[$,ee]=(0,i.useState)(""),[en,et]=(0,i.useState)(null),el=(0,s.p)(),ei=(0,i.useMemo)(()=>{switch(y){case"SectionUnit":case"PlainTextUnit":return[{key:"text",label:"Text",placeholder:"Content"}];case"MarkdownUnit":case"AlertUnit":return[{key:"content",label:"Content",placeholder:"Markdown or alert content"}];case"VideoMedia":return[{key:"src",label:"Video URL",placeholder:"/videos/demo.mp4"},{key:"autoplay",label:"Autoplay",placeholder:""}];case"PDFMedia":return[{key:"src",label:"PDF URL",placeholder:"/docs/guide.pdf"},{key:"title",label:"Title",placeholder:"Document title"}];case"ExperienceComponent":return[{key:"position",label:"Position",placeholder:"Lead Designer"},{key:"company",label:"Company",placeholder:"Studio"},{key:"start_date",label:"Start date",placeholder:"2022"},{key:"end_date",label:"End date",placeholder:"Present"},{key:"image",label:"Image",placeholder:"/images/logo.png"},{key:"content",label:"Summary",placeholder:"Role summary"}];case"StyleContainer":return[{key:"isTransparent",label:"Transparent",placeholder:""}];default:return[]}},[y]),ea=(0,i.useCallback)(async e=>{try{let a=await (0,u.S)("/nodes/".concat(e,"/resolved")),r=[],o=[a];for(;o.length;){var n,t,l,i;let e=o.pop();if(e){if((null===(n=e.component)||void 0===n?void 0:n.type)==="SectionUnit"){let n=String(null!==(i=null===(l=e.config)||void 0===l?void 0:l.text)&&void 0!==i?i:"Section");r.push({node_id:e.node.node_id,title:n})}(null===(t=e.children)||void 0===t?void 0:t.length)&&o.push(...e.children)}}B(r),W(null)}catch(e){E(e instanceof Error?e.message:"Failed to load sections")}},[]),er=(0,i.useCallback)(async()=>{try{let n=await (0,u.S)("/views");if(O(n),!V){var e;let t=n.find(e=>null!==e.node_id);R(null!==(e=null==t?void 0:t.node_id)&&void 0!==e?e:null),(null==t?void 0:t.node_id)&&ea(t.node_id)}}catch(e){E(e instanceof Error?e.message:"Failed to load views")}},[V,ea]),eo=(0,i.useCallback)((e,n)=>{var t,l,i,a,r,o,s,d;switch(e){case"SectionUnit":return String(null!==(t=n.text)&&void 0!==t?t:"Section");case"PlainTextUnit":return String(null!==(l=n.text)&&void 0!==l?l:"Text");case"MarkdownUnit":return String(null!==(i=n.content)&&void 0!==i?i:"Markdown").slice(0,60);case"AlertUnit":return String(null!==(a=n.content)&&void 0!==a?a:"Alert").slice(0,60);case"LinkUnit":return String(null!==(r=n.label)&&void 0!==r?r:"Link");case"ImageMedia":case"VideoMedia":case"PDFMedia":return String(null!==(o=n.src)&&void 0!==o?o:"Media");case"ExperienceComponent":return"".concat(String(null!==(s=n.position)&&void 0!==s?s:"Role")," @ ").concat(String(null!==(d=n.company)&&void 0!==d?d:"")).trim();default:return e}},[]),es=(0,i.useCallback)((e,n,t)=>{var l,i,a,r,o;switch(e){case"SectionUnit":case"PlainTextUnit":return String(null!==(l=n.text)&&void 0!==l?l:"").slice(0,120);case"MarkdownUnit":case"AlertUnit":return String(null!==(i=n.content)&&void 0!==i?i:"").slice(0,120);case"LinkUnit":return String(null!==(a=n.url)&&void 0!==a?a:"");case"ImageMedia":case"VideoMedia":case"PDFMedia":return String(null!==(r=n.src)&&void 0!==r?r:"");case"ExperienceComponent":return String(null!==(o=n.content)&&void 0!==o?o:"").slice(0,120);case"ListContainer":case"InlineContainer":case"StyleContainer":return"".concat(t," child component").concat(1===t?"":"s");default:return""}},[]),ed=(0,i.useCallback)(async e=>{try{var n,t,l,i,a,r,o,s,d,c,h,p,v,m,f;let g=await (0,u.S)("/nodes/".concat(e,"/resolved")),x=[],j=[g];for(;j.length;){let e=j.pop();if(!e)continue;let u=null===(n=e.component)||void 0===n?void 0:n.type;if(u&&"ViewContainer"!==u){let n=null!==(o=null===(l=e.children)||void 0===l?void 0:l.length)&&void 0!==o?o:0,t=es(u,null!==(s=e.config)&&void 0!==s?s:{},n),v="ImageMedia"===u?String(null!==(d=null===(i=e.config)||void 0===i?void 0:i.src)&&void 0!==d?d:""):void 0;x.push({ref_id:null!==(c=null===(a=e.reference)||void 0===a?void 0:a.ref_id)&&void 0!==c?c:e.node.node_id,comp_id:e.component.comp_id,type:u,label:eo(u,null!==(h=e.config)&&void 0!==h?h:{}),node_id:e.node.node_id,preview:t,previewSrc:v,childCount:n,overrides:null!==(p=null===(r=e.reference)||void 0===r?void 0:r.overrides)&&void 0!==p?p:null})}(null===(t=e.children)||void 0===t?void 0:t.length)&&j.push(...e.children)}q(x);let b=Array.from(new Set(x.map(e=>e.type))),y=null!==(v=b[0])&&void 0!==v?v:"";ee(y);let S=null!==(m=x.find(e=>e.type===y))&&void 0!==m?m:x[0];et(null!==(f=null==S?void 0:S.ref_id)&&void 0!==f?f:null)}catch(e){E(e instanceof Error?e.message:"Failed to load mirror components")}},[eo,es]),ec=(0,i.useCallback)(async()=>{try{let n=await (0,u.S)("/views");if(Q(n),!X){var e;let t=n.find(e=>null!==e.node_id);Y(null!==(e=null==t?void 0:t.node_id)&&void 0!==e?e:null),(null==t?void 0:t.node_id)&&ed(t.node_id)}}catch(e){E(e instanceof Error?e.message:"Failed to load mirror views")}},[X,ed]);async function eu(e){let n=new FormData;n.append("file",e);let t=await fetch("".concat(h.J.authorApiBaseUrl,"/save-image"),{method:"POST",body:n});if(!t.ok)throw Error(await t.text()||"Upload failed");return await t.json()}async function eh(e){let n=await fetch("".concat(h.J.authorApiBaseUrl,"/fetch-image"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});if(!n.ok)throw Error(await n.text()||"Fetch failed");return await n.json()}async function ep(e){e.preventDefault();try{var n,t;N(!0),E(null);let e={...w};if("Mirror"===y){if(!X)throw Error("Select a view to mirror from");if(!en)throw Error("Select a component to mirror");if($&&0===Z.filter(e=>e.type===$).length)throw Error("No components match that type")}if("LinkUnit"===y){if("external"===I)e.url=P.trim();else{let t=A.find(e=>e.node_id===V),l=null!==(n=null==t?void 0:t.config.path)&&void 0!==n?n:"/",i=J?"#section-".concat(J):"";e.url="".concat(l).concat(i)}}if("Mirror"===y){if(!en)throw Error("Select a component to mirror");let e=Z.find(e=>e.ref_id===en);if(!e)throw Error("Selected component not found");await (0,u.S)("/nodes/".concat(f,"/children/mirror"),{method:"POST",body:JSON.stringify({comp_id:e.comp_id,overrides:null!==(t=e.overrides)&&void 0!==t?t:null})})}else await (0,u.S)("/nodes/".concat(f,"/children"),{method:"POST",body:JSON.stringify({component_type:y,config:function(e,n){var t,l,i,a,r,o,s,d,c,u,h,p,v,m,f,g,x;switch(e){case"SectionUnit":return{text:null!==(t=n.text)&&void 0!==t?t:"New section",level:"h2"};case"PlainTextUnit":return{text:null!==(l=n.text)&&void 0!==l?l:""};case"MarkdownUnit":return{content:null!==(i=n.content)&&void 0!==i?i:""};case"AlertUnit":return{content:null!==(a=n.content)&&void 0!==a?a:"",variant:"info"};case"LinkUnit":return{label:null!==(r=n.label)&&void 0!==r?r:"Link",url:null!==(o=n.url)&&void 0!==o?o:"/"};case"ImageMedia":return{src:null!==(s=n.src)&&void 0!==s?s:"",alt:null!==(d=n.alt)&&void 0!==d?d:""};case"VideoMedia":return{src:null!==(c=n.src)&&void 0!==c?c:"",autoplay:"true"===n.autoplay};case"PDFMedia":return{src:null!==(u=n.src)&&void 0!==u?u:"",title:null!==(h=n.title)&&void 0!==h?h:""};case"ExperienceComponent":return{position:null!==(p=n.position)&&void 0!==p?p:"",company:null!==(v=n.company)&&void 0!==v?v:"",start_date:null!==(m=n.start_date)&&void 0!==m?m:"",end_date:null!==(f=n.end_date)&&void 0!==f?f:"",image:null!==(g=n.image)&&void 0!==g?g:"",content:null!==(x=n.content)&&void 0!==x?x:""};case"StyleContainer":return{isTransparent:"true"===n.isTransparent,child_node_id:null};default:return{}}}(y,e)})});k({}),T(""),L(""),et(null),q([]),ee(""),b.refresh(),el.push("Component added","success"),j&&j()}catch(e){E(e instanceof Error?e.message:"Failed to add component"),el.push("Failed to add component","error")}finally{N(!1)}}async function ev(e){var n;let t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(t){if(t.size>20971520){E("File is larger than 20MB"),el.push("File is larger than 20MB","error");return}try{M(!0),E(null);let e=await eu(t);k(n=>({...n,src:e.src})),el.push("Image uploaded","success")}catch(e){E(e instanceof Error?e.message:"Failed to upload file"),el.push("Upload failed","error")}finally{M(!1)}}}async function em(){if(P.trim())try{M(!0),E(null);let e=await eh(P.trim());k(n=>({...n,src:e.src})),el.push("Image fetched","success")}catch(e){E(e instanceof Error?e.message:"Failed to fetch image"),el.push("Fetch failed","error")}finally{M(!1)}}return(0,i.useEffect)(()=>{"LinkUnit"===y&&"internal"===I&&0===A.length&&er(),"Mirror"===y&&0===K.length&&ec(),"LinkUnit"!==y&&(F("internal"),T(""),W(null))},[y,I,er,A.length,K.length,ec]),(0,i.useEffect)(()=>{"Mirror"===y&&X&&ed(X)},[y,X,ed]),(0,l.jsxs)("form",{className:"author-card",onSubmit:ep,children:[(0,l.jsxs)("div",{className:"author-header",children:[(0,l.jsx)("h3",{children:"Add component"}),(0,l.jsx)("select",{value:y,onChange:e=>S(e.target.value),children:p.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{className:"form-grid",children:[ei.map(e=>{var n,t;return"isTransparent"===e.key||"autoplay"===e.key?(0,l.jsxs)("div",{className:"toggle-row",children:[(0,l.jsx)("span",{children:e.label}),(0,l.jsx)(d.r,{checked:"true"===w[e.key],onCheckedChange:n=>k(t=>({...t,[e.key]:n?"true":"false"})),"aria-label":e.label})]},e.key):(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:e.label}),"MarkdownUnit"===y&&"content"===e.key?(0,l.jsx)("textarea",{value:null!==(n=w[e.key])&&void 0!==n?n:"",onChange:n=>k(t=>({...t,[e.key]:n.target.value})),placeholder:e.placeholder}):(0,l.jsx)("input",{value:null!==(t=w[e.key])&&void 0!==t?t:"",onChange:n=>k(t=>({...t,[e.key]:n.target.value})),placeholder:e.placeholder})]},e.key)}),"Mirror"===y?(0,l.jsxs)("div",{className:"form-grid",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Component type"}),(0,l.jsx)("select",{value:$,onChange:e=>{var n;let t=e.target.value;ee(t);let l=Z.find(e=>e.type===t);et(null!==(n=null==l?void 0:l.ref_id)&&void 0!==n?n:null)},disabled:0===Z.length,children:Array.from(new Set(Z.map(e=>e.type))).map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"View"}),(0,l.jsx)("select",{value:null!=X?X:"",onChange:e=>{Y(Number(e.target.value))},onFocus:()=>{0===K.length&&ec()},children:K.filter(e=>null!==e.node_id).map(e=>{var n,t,i,a,r,o;return(0,l.jsx)("option",{value:null!==(n=e.node_id)&&void 0!==n?n:"",children:null!==(a=null!==(i=null!==(t=e.config.title)&&void 0!==t?t:e.config.name)&&void 0!==i?i:e.config.path)&&void 0!==a?a:"Untitled"},null!==(o=null!==(r=e.node_id)&&void 0!==r?r:e.config.path)&&void 0!==o?o:"unknown")})})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Component"}),(0,l.jsx)("select",{value:null!=en?en:"",onChange:e=>et(Number(e.target.value)),disabled:0===Z.length||!$||0===Z.filter(e=>e.type===$).length,children:Z.filter(e=>!$||e.type===$).map(e=>(0,l.jsx)("option",{value:e.ref_id,children:e.label},"".concat(e.ref_id,"-").concat(e.node_id)))}),$&&0===Z.filter(e=>e.type===$).length?(0,l.jsx)("span",{className:"form-hint error",children:"No components match that type."}):null]}),en?(0,l.jsx)("div",{className:"mirror-preview",children:Z.filter(e=>e.ref_id===en).map(e=>(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:e.label}),(0,l.jsx)("div",{className:"muted",children:e.type}),e.previewSrc?(0,l.jsx)("div",{className:"image-preview",children:(0,l.jsx)(r.default,{src:e.previewSrc,alt:e.label,width:640,height:360,unoptimized:!0,style:{width:"100%",height:"auto"}})}):e.preview?(0,l.jsx)("div",{className:"muted",children:e.preview}):null]},"preview-".concat(e.ref_id)))}):null,Z.length?null:(0,l.jsx)("p",{className:"muted",children:"No components found for that view."})]}):null,"MarkdownUnit"===y?(0,l.jsxs)("div",{className:"form-grid",children:[(0,l.jsxs)("label",{className:"toggle",children:[(0,l.jsx)("input",{type:"checkbox",checked:G,onChange:e=>H(e.target.checked)}),(0,l.jsx)("span",{children:"Preview markdown"})]}),G?(0,l.jsx)("div",{className:"section-card",children:(0,l.jsx)(a.UG,{children:null!==(n=w.content)&&void 0!==n?n:""})}):null]}):null,"LinkUnit"===y?(0,l.jsxs)("div",{className:"link-editor",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Label"}),(0,l.jsx)("input",{value:null!==(t=w.label)&&void 0!==t?t:"",onChange:e=>k(n=>({...n,label:e.target.value})),placeholder:"Link label"})]}),(0,l.jsxs)("div",{className:"toggle-row",children:[(0,l.jsxs)("label",{className:"toggle",children:[(0,l.jsx)("input",{type:"radio",name:"linkType",value:"internal",checked:"internal"===I,onChange:()=>F("internal")}),(0,l.jsx)("span",{children:"Internal"})]}),(0,l.jsxs)("label",{className:"toggle",children:[(0,l.jsx)("input",{type:"radio",name:"linkType",value:"external",checked:"external"===I,onChange:()=>F("external")}),(0,l.jsx)("span",{children:"External"})]})]}),"external"===I?(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"URL"}),(0,l.jsx)("input",{value:P,onChange:e=>T(e.target.value),placeholder:"https://example.com"})]}):(0,l.jsxs)("div",{className:"form-grid",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"View"}),(0,l.jsx)("select",{value:null!=V?V:"",onChange:e=>{let n=Number(e.target.value);R(n),ea(n)},onFocus:()=>{0===A.length&&er()},children:A.map(e=>{var n,t,i,a,r,o;return(0,l.jsx)("option",{value:null!==(n=e.node_id)&&void 0!==n?n:"",children:null!==(a=null!==(i=null!==(t=e.config.title)&&void 0!==t?t:e.config.name)&&void 0!==i?i:e.config.path)&&void 0!==a?a:"Untitled"},null!==(o=null!==(r=e.node_id)&&void 0!==r?r:e.config.path)&&void 0!==o?o:"unknown")})})]}),z.length?(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Section"}),(0,l.jsxs)("select",{value:null!=J?J:"",onChange:e=>{let n=e.target.value;W(n?Number(n):null)},children:[(0,l.jsx)("option",{value:"",children:"None"}),z.map(e=>(0,l.jsx)("option",{value:e.node_id,children:e.title},e.node_id))]})]}):null]})]}):null,"ImageMedia"===y?(0,l.jsxs)("div",{className:"image-uploader",children:[w.src?(0,l.jsx)("div",{className:"image-preview",children:(0,l.jsx)(r.default,{src:w.src,alt:null!==(v=w.alt)&&void 0!==v?v:"",width:960,height:540,unoptimized:!0,style:{width:"100%",height:"auto"}})}):null,(0,l.jsxs)("div",{className:"form-grid",children:[(0,l.jsx)(o.P,{label:"Choose from library",allowedPrefixes:["image/"],onSelect:e=>k(n=>({...n,src:e}))}),(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Upload file"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:ev})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Fetch external URL"}),(0,l.jsxs)("div",{className:"form-row",children:[(0,l.jsx)("input",{value:P,onChange:e=>T(e.target.value),placeholder:"https://example.com/image.jpg"}),(0,l.jsx)("button",{className:"button ghost",type:"button",onClick:em,disabled:_,children:"Fetch"})]})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Use relative URL"}),(0,l.jsxs)("div",{className:"form-row",children:[(0,l.jsx)("input",{value:D,onChange:e=>L(e.target.value),placeholder:"/images/hero.jpg"}),(0,l.jsx)("button",{className:"button ghost",type:"button",onClick:function(){if(!D.trim())return;let e=D.startsWith("/")?D.trim():"/".concat(D.trim());k(n=>({...n,src:e}))},children:"Use"})]})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Alt text"}),(0,l.jsx)("input",{value:null!==(m=w.alt)&&void 0!==m?m:"",onChange:e=>k(n=>({...n,alt:e.target.value})),placeholder:"Optional description"})]})]})]}):null,"VideoMedia"===y?(0,l.jsx)("div",{className:"form-grid",children:(0,l.jsx)(o.P,{label:"Choose video from library",allowedPrefixes:["video/"],onSelect:e=>k(n=>({...n,src:e}))})}):null,"PDFMedia"===y?(0,l.jsx)("div",{className:"form-grid",children:(0,l.jsx)(o.P,{label:"Choose PDF from library",allowedPrefixes:["application/pdf"],onSelect:e=>k(n=>({...n,src:e}))})}):null]}),U?(0,l.jsx)("div",{className:"alert",children:U}):null,(0,l.jsx)("button",{className:x,type:"submit",disabled:C,children:C?"Saving...":g})]})}function m(e){let{open:n,onClose:t,title:a,size:r="default",children:o}=e;return((0,i.useEffect)(()=>{if(!n)return;let e=e=>{"Escape"===e.key&&t()};return document.body.style.overflow="hidden",window.addEventListener("keydown",e),()=>{document.body.style.overflow="",window.removeEventListener("keydown",e)}},[n,t]),n)?(0,l.jsx)("div",{className:"dialog-overlay",role:"dialog","aria-modal":"true","aria-labelledby":a?"modal-title":void 0,onClick:t,children:(0,l.jsxs)("div",{className:"dialog".concat("wide"===r?" dialog-wide":""),onClick:e=>e.stopPropagation(),children:[a?(0,l.jsx)("h3",{id:"modal-title",children:a}):null,o]})}):null}var f=t(3513);function g(e){let{parentNodeId:n,buttonLabel:t="Add Component"}=e,[a,r]=(0,i.useState)(!1);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"button add-component add-component-bottom icon-only",type:"button",onClick:()=>r(!0),"aria-label":t,title:t,children:(0,l.jsx)(f.dt,{size:26,strokeWidth:2,"aria-hidden":!0})}),(0,l.jsx)(m,{open:a,onClose:()=>r(!1),size:"wide",children:(0,l.jsx)(v,{parentNodeId:n,submitLabel:"Save",submitClassName:"button success",onAdded:()=>r(!1)})})]})}},5175:function(e,n,t){"use strict";t.d(n,{P:function(){return o}});var l=t(7437),i=t(2265),a=t(6648),r=t(8199);function o(e){let{label:n,onSelect:t,allowedPrefixes:o}=e,[s,d]=(0,i.useState)([]),[c,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null),[v,m]=(0,i.useState)(""),[f,g]=(0,i.useState)("name"),[x,j]=(0,i.useState)("all"),[b,y]=(0,i.useState)({}),S=(0,i.useMemo)(()=>{let e=[{value:"all",label:"All"}];return o.some(e=>e.startsWith("image/"))&&e.push({value:"image",label:"Images"}),o.some(e=>e.startsWith("video/"))&&e.push({value:"video",label:"Video"}),o.some(e=>"application/pdf"===e)&&e.push({value:"pdf",label:"PDF"}),e.push({value:"other",label:"Other"}),e},[o]),w=(0,i.useMemo)(()=>{let e=v.trim().toLowerCase(),n=s.filter(n=>n.name.toLowerCase().includes(e));return"all"!==x&&(n=n.filter(e=>"image"===x?e.mime.startsWith("image/"):"video"===x?e.mime.startsWith("video/"):"pdf"===x?"application/pdf"===e.mime:!e.mime.startsWith("image/")&&!e.mime.startsWith("video/")&&"application/pdf"!==e.mime)),[...n].sort((e,n)=>"size"===f?n.size-e.size:e.name.localeCompare(n.name))},[s,v,f,x]);return(0,i.useEffect)(()=>{c&&Promise.all([(0,r.S)("/assets"),(0,r.S)("/assets/usage")]).then(e=>{let[n,t]=e;d(n.filter(e=>o.some(n=>e.mime.startsWith(n)))),y(t)}).catch(e=>p(e instanceof Error?e.message:"Failed to load assets"))},[c,o]),(0,l.jsxs)("div",{className:"asset-picker",children:[(0,l.jsx)("button",{className:"button ghost",type:"button",onClick:()=>u(e=>!e),children:c?"Close":n}),c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"form-grid",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Search"}),(0,l.jsx)("input",{value:v,onChange:e=>m(e.target.value),placeholder:"Search assets"})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Type"}),(0,l.jsx)("select",{value:x,onChange:e=>j(e.target.value),children:S.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("span",{children:"Sort"}),(0,l.jsxs)("select",{value:f,onChange:e=>g(e.target.value),children:[(0,l.jsx)("option",{value:"name",children:"Name"}),(0,l.jsx)("option",{value:"size",children:"Size"})]})]})]}),(0,l.jsxs)("div",{className:"media-grid",children:[w.map(e=>{var n;return(0,l.jsxs)("button",{type:"button",className:"media-card",onClick:()=>{t(e.src),u(!1)},children:[b[e.src]?(0,l.jsxs)("span",{className:"badge secondary",children:["Used ",b[e.src].count,"x"]}):(0,l.jsx)("span",{className:"badge",children:"Unused"}),(0,l.jsx)("div",{className:"media-preview",children:e.mime.startsWith("image/")?(0,l.jsx)(a.default,{src:e.src,alt:e.name,width:320,height:200,unoptimized:!0,style:{width:"100%",height:"auto"}}):(0,l.jsxs)("div",{className:"media-placeholder",children:[(0,l.jsx)("strong",{children:null!==(n=e.mime.split("/")[1])&&void 0!==n?n:"file"}),(0,l.jsx)("span",{children:e.name})]})}),(0,l.jsxs)("div",{className:"media-meta",children:[(0,l.jsx)("span",{children:e.name}),(0,l.jsxs)("span",{className:"muted",children:[Math.round(e.size/1024)," KB"]})]})]},e.name)}),w.length?null:(0,l.jsx)("p",{className:"muted",children:"No assets available."})]})]}):null,h?(0,l.jsx)("div",{className:"alert",children:h}):null]})}},2586:function(e,n,t){"use strict";t.d(n,{Q:function(){return a}});var l=t(7437),i=t(2265);function a(e){let{open:n,title:t,description:a,confirmLabel:r="Confirm",cancelLabel:o="Cancel",onConfirm:s,onCancel:d,danger:c=!1,isBusy:u=!1}=e;return((0,i.useEffect)(()=>{if(!n)return;let e=e=>{"Escape"===e.key&&d()};return document.body.style.overflow="hidden",window.addEventListener("keydown",e),()=>{document.body.style.overflow="",window.removeEventListener("keydown",e)}},[n,d]),n)?(0,l.jsx)("div",{className:"dialog-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title",onClick:d,children:(0,l.jsxs)("div",{className:"dialog",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("h3",{id:"dialog-title",children:t}),a?(0,l.jsx)("p",{className:"muted",children:a}):null,(0,l.jsxs)("div",{className:"dialog-actions",children:[(0,l.jsx)("button",{className:"button ghost",type:"button",onClick:d,disabled:u,children:o}),(0,l.jsx)("button",{className:"button ".concat(c?"danger":""),type:"button",onClick:s,disabled:u,children:u?"Working...":r})]})]})}):null}},6987:function(e,n,t){"use strict";t.d(n,{r:function(){return o}});var l=t(7437),i=t(2265),a=t(7428),r=t(4839);let o=i.forwardRef((e,n)=>{let{className:t,...i}=e;return(0,l.jsx)(a.fC,{ref:n,className:(0,r.Z)("switch-root",t),...i,children:(0,l.jsx)(a.bU,{className:"switch-thumb"})})});o.displayName="Switch"},2151:function(e,n,t){"use strict";t.d(n,{ToastProvider:function(){return r},p:function(){return o}});var l=t(7437),i=t(2265);let a=(0,i.createContext)(null);function r(e){let{children:n}=e,[t,r]=(0,i.useState)([]),o=(0,i.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t="".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2));r(l=>[...l,{id:t,message:e,type:n}]),setTimeout(()=>{r(e=>e.filter(e=>e.id!==t))},3500)},[]),s=(0,i.useMemo)(()=>({push:o}),[o]);return(0,l.jsxs)(a.Provider,{value:s,children:[n,(0,l.jsx)("div",{className:"toast-stack",children:t.map(e=>(0,l.jsx)("div",{className:"toast toast-".concat(e.type),children:e.message},e.id))})]})}function o(){let e=(0,i.useContext)(a);if(!e)throw Error("useToast must be used within ToastProvider");return e}},3513:function(e,n,t){"use strict";t.d(n,{_8:function(){return a},dY:function(){return o},dt:function(){return s},pJ:function(){return r}});var l=t(7437);function i(e){let{title:n,size:t=20,viewBox:i="0 0 24 24",children:a,...r}=e,o=r["aria-label"],s=!!(n||o);return(0,l.jsxs)("svg",{width:t,height:t,viewBox:i,fill:"none",stroke:"currentColor",strokeWidth:1.6,strokeLinecap:"round",strokeLinejoin:"round",role:s?"img":"presentation","aria-hidden":!s||void 0,focusable:"false",...r,children:[n?(0,l.jsx)("title",{children:n}):null,a]})}function a(e){return(0,l.jsxs)(i,{...e,children:[(0,l.jsx)("path",{d:"M12 4v9"}),(0,l.jsx)("path",{d:"m9 10 3 3 3-3"}),(0,l.jsx)("path",{d:"M5 15v4h14v-4"})]})}function r(e){return(0,l.jsxs)(i,{...e,children:[(0,l.jsx)("path",{d:"M5 7h14"}),(0,l.jsx)("path",{d:"M9 7V4h6v3"}),(0,l.jsx)("path",{d:"M7 7l1 13h8l1-13"}),(0,l.jsx)("path",{d:"M10 11v6"}),(0,l.jsx)("path",{d:"M14 11v6"})]})}function o(e){return(0,l.jsxs)(i,{...e,children:[(0,l.jsx)("path",{d:"M4 20h4l10-10-4-4L4 16v4z"}),(0,l.jsx)("path",{d:"M13.5 6.5 17.5 10.5"})]})}function s(e){return(0,l.jsxs)(i,{...e,children:[(0,l.jsx)("path",{d:"M12 5v14"}),(0,l.jsx)("path",{d:"M5 12h14"})]})}},16:function(e,n,t){"use strict";t.d(n,{DragScopeProvider:function(){return r},G:function(){return o}});var l=t(7437),i=t(2265);let a=(0,i.createContext)(null);function r(e){let{children:n}=e,[t,r]=(0,i.useState)(null),[o,s]=(0,i.useState)(null),[d,c]=(0,i.useState)(null),u=(0,i.useCallback)((e,n,t)=>{r(e),s(n),c(t)},[]),h=(0,i.useCallback)(()=>{r(null),s(null),c(null)},[]),p=(0,i.useMemo)(()=>({draggingId:t,draggingType:o,activeScopeId:d,isDragging:null!==t,startDrag:u,endDrag:h,setActiveScopeId:c}),[t,o,d,u,h]);return(0,l.jsx)(a.Provider,{value:p,children:n})}function o(){return(0,i.useContext)(a)}},5804:function(e,n,t){"use strict";t.d(n,{ViewChildrenSortable:function(){return r}});var l=t(7437),i=t(2265),a=t(8601);function r(e){let{nodes:n,containerNodeId:t,containerConfig:r}=e,o=(0,i.useCallback)(()=>!0,[]);return(0,l.jsx)(a.O,{nodes:n,enabled:!0,containerNodeId:t,containerType:"ViewContainer",containerConfig:r,isCompatible:o})}},8601:function(e,n,t){"use strict";t.d(n,{O:function(){return m},ViewComponentRenderer:function(){return f}});var l=t(7437),i=t(2731),a=t(6648),r=t(2265),o=t(6463),s=t(8199),d=t(2151);t(5175),t(2586),t(6987),t(3513);t(9580);var c=t(16);let u=new Set(["ViewContainer","ListContainer","InlineContainer","StyleContainer"]);function h(){return(0,l.jsx)("svg",{viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",children:(0,l.jsx)("path",{fill:"currentColor",d:"M7 4l6 6-6 6v-4H3v-4h4V4z"})})}function p(){return(0,l.jsx)("svg",{viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",children:(0,l.jsx)("path",{fill:"currentColor",d:"M13 4v4h4v4h-4v4l-6-6 6-6z"})})}function v(e){let{direction:n,targetScopeId:t,active:i}=e,a=(0,c.G)(),[o,s]=(0,r.useState)(!1),d=(0,r.useRef)(null),u=(0,r.useCallback)(()=>{d.current&&(window.clearTimeout(d.current),d.current=null)},[]),v=(0,r.useCallback)(()=>{s(!1),u()},[u]),m=(0,r.useCallback)(()=>{i&&(s(!0),d.current||(d.current=window.setTimeout(()=>{null==a||a.setActiveScopeId(t),s(!1),d.current=null},2e3)))},[i,a,t]);return(0,r.useEffect)(()=>(i||v(),()=>u()),[i,v,u]),(0,l.jsx)("div",{className:"scope-arrow scope-arrow-".concat(n).concat(o?" glow":""),onDragEnter:e=>{i&&(e.preventDefault(),m())},onDragOver:e=>{i&&e.preventDefault()},onDragLeave:v,onDrop:e=>{e.preventDefault()},"aria-hidden":!0,children:"down"===n?(0,l.jsx)(h,{}):(0,l.jsx)(p,{})})}function m(e){var n,t;let{nodes:i,enabled:a,containerNodeId:h,containerType:p,containerConfig:m,isCompatible:g}=e,[x,j]=(0,r.useState)(i),[b,y]=(0,r.useState)(null),S=(0,o.useRouter)(),w=(0,d.p)(),k=(0,c.G)(),C=null!==(n=null==k?void 0:k.draggingId)&&void 0!==n?n:null,N=null!==(t=null==k?void 0:k.draggingType)&&void 0!==t?t:"",_=a&&!!(null==k?void 0:k.isDragging),M=_&&(null==k?void 0:k.activeScopeId)===h;async function U(e,n,t){if(n===t)return;let l=n<t?"down":"up",i=Math.abs(n-t);try{for(let n=0;n<i;n+=1)await (0,s.S)("/nodes/".concat(e,"/move"),{method:"PUT",body:JSON.stringify({direction:l})});w.push("Order updated","success"),S.refresh()}catch(e){w.push("Reorder failed","error"),S.refresh()}}async function E(e,n){var t,l;if(e.preventDefault(),e.stopPropagation(),!M)return;let i=function(e){try{let n=e.dataTransfer.getData("application/json");if(!n)return null;return JSON.parse(n)}catch(e){return null}}(e),a=null!==(t=null==i?void 0:i.nodeId)&&void 0!==t?t:C,r=null!==(l=null==i?void 0:i.componentType)&&void 0!==l?l:N;if(!a)return;if(!g(r,p,m)){w.push("Incompatible item for this list","error");return}if(a===n)return;let o=x.findIndex(e=>e.node.node_id===a),d=x.findIndex(e=>e.node.node_id===n);if(d<0)return;if(o<0){try{await (0,s.S)("/nodes/".concat(a,"/reparent"),{method:"PUT",body:JSON.stringify({target_parent_node_id:h,before_node_id:n})}),w.push("Moved into container","success"),S.refresh()}catch(e){w.push("Move failed","error")}return}let c=[...x],[u]=c.splice(o,1);c.splice(d,0,u),j(c),U(a,o,d),y(null)}(0,r.useEffect)(()=>{j(i)},[i]),(0,r.useEffect)(()=>{_&&M||y(null)},[_,M]);let P=M&&C?x.findIndex(e=>e.node.node_id===C):-1;return(0,l.jsx)("div",{className:"sortable-list",children:x.map((e,n)=>{let t=u.has(e.component.type),i=M&&t&&P>=0&&1===Math.abs(n-P),r=M&&t&&_;return(0,l.jsxs)("div",{className:"draggable-item".concat(C===e.node.node_id?" dragging":"").concat(b===e.node.node_id?" drag-over":"").concat(r?" scope-down":""),draggable:a,onDragStart:n=>{if(a){var t;if((t=n.target)instanceof HTMLElement&&t.closest("button, input, textarea, select, a, [contenteditable='true']")){n.preventDefault();return}null==k||k.startDrag(e.node.node_id,e.component.type,h),n.dataTransfer.setData("application/json",JSON.stringify({nodeId:e.node.node_id,componentType:e.component.type})),n.dataTransfer.effectAllowed="move"}},onDragEnd:()=>{null==k||k.endDrag(),y(null)},onDragOver:n=>{a&&M&&(n.preventDefault(),y(e.node.node_id))},onDrop:n=>E(n,e.node.node_id),children:[i?(0,l.jsx)(v,{direction:"down",targetScopeId:e.node.node_id,active:_}):null,(0,l.jsx)(f,{node:e})]},e.node.node_id)})})}function f(e){var n,t,s,h,p,m,g,x,j,b,y,S,w,k,C,N,_,M,U;let{node:E}=e,{component:P,config:T}=E,[D,L]=((0,d.p)(),(0,o.useRouter)(),(0,r.useState)(!1)),I=(0,c.G)(),F=!!(null==I?void 0:I.isDragging),A=null!==(n=null==I?void 0:I.activeScopeId)&&void 0!==n?n:null;if((0,r.useEffect)(()=>{F||L(!1)},[F]),(0,r.useEffect)(()=>{u.has(P.type)&&A!==E.node.node_id&&L(!1)},[A,P.type,E.node.node_id]),"ViewContainer"===P.type||"ListContainer"===P.type||"InlineContainer"===P.type||"StyleContainer"===P.type){String(null!==(t=T.displayMode)&&void 0!==t?t:"list");let e=!!T.isTransparent,n=A===E.node.node_id,i=!!(F&&n&&E.node.parent_node_id),a="StyleContainer"===P.type?"style-container".concat(e?" style-container--transparent":""):"section",r="".concat(a).concat("").concat(D?" container-drop":"").concat(i?" scope-parent scope-up":"");return(0,l.jsxs)("div",{className:r,onDragOver:e=>{},onDragLeave:()=>{},onDrop:e=>{},children:[i&&E.node.parent_node_id?(0,l.jsx)(v,{direction:"up",targetScopeId:E.node.parent_node_id,active:!!(null==I?void 0:I.isDragging)}):null,null,E.children.map(e=>(0,l.jsx)(f,{node:e},e.node.node_id)),null]})}switch(P.type){case"SectionUnit":{let e=null!==(s=T.level)&&void 0!==s?s:"h2";return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,(0,l.jsx)("h1"===e?"h1":"h3"===e?"h3":"h2",{id:"section-".concat(E.node.node_id),children:String(null!==(h=T.text)&&void 0!==h?h:"Untitled section")})]})}case"PlainTextUnit":return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,(0,l.jsx)("p",{children:String(null!==(p=T.text)&&void 0!==p?p:"")})]});case"AlertUnit":return(0,l.jsxs)("div",{className:"section-card".concat(""),role:"status",children:[null,(0,l.jsx)("strong",{children:String(null!==(m=T.variant)&&void 0!==m?m:"info").toUpperCase()}),(0,l.jsx)("p",{children:String(null!==(g=T.content)&&void 0!==g?g:"")})]});case"MarkdownUnit":return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,(0,l.jsx)(i.UG,{children:String(null!==(x=T.content)&&void 0!==x?x:"")})]});case"LinkUnit":return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,(0,l.jsx)("a",{href:String(null!==(j=T.url)&&void 0!==j?j:"#"),children:String(null!==(b=T.label)&&void 0!==b?b:"Link")})]});case"ImageMedia":return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,String(null!==(y=T.src)&&void 0!==y?y:"")?(0,l.jsx)(a.default,{src:String(null!==(S=T.src)&&void 0!==S?S:""),alt:String(null!==(w=T.alt)&&void 0!==w?w:""),width:960,height:640,unoptimized:!0,style:{width:"100%",height:"auto",borderRadius:12}}):null]});case"VideoMedia":return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,(0,l.jsx)("video",{controls:!0,autoPlay:!!T.autoplay,src:String(null!==(k=T.src)&&void 0!==k?k:""),style:{width:"100%",borderRadius:12}})]});case"PDFMedia":return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,(0,l.jsx)("iframe",{src:String(null!==(C=T.src)&&void 0!==C?C:""),title:String(null!==(N=T.title)&&void 0!==N?N:"Document"),style:{width:"100%",minHeight:500,border:"none"}})]});case"ExperienceComponent":return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,(0,l.jsx)("h3",{children:String(null!==(_=T.position)&&void 0!==_?_:"Role")}),(0,l.jsx)("p",{children:String(null!==(M=T.company)&&void 0!==M?M:"")}),(0,l.jsx)("p",{children:String(null!==(U=T.content)&&void 0!==U?U:"")})]});default:return(0,l.jsxs)("div",{className:"section-card".concat(""),children:[null,(0,l.jsxs)("p",{children:["Unsupported component type: ",P.type]})]})}}},8199:function(e,n,t){"use strict";t.d(n,{S:function(){return i}});let l=t(973).J.authorApiBaseUrl;async function i(e,n){var t,i;let a="".concat(l).concat(e),r=performance.now(),o=await fetch(a,{...n,headers:{"Content-Type":"application/json",...null!==(t=null==n?void 0:n.headers)&&void 0!==t?t:{}},cache:"no-store"}),s=Math.round((performance.now()-r)*10)/10;if("→ ".concat(null!==(i=null==n?void 0:n.method)&&void 0!==i?i:"GET"," ").concat(e),!o.ok){let e=await o.text();throw Error("API ".concat(o.status,": ").concat(e))}let d=await o.json();return"← ".concat(o.status," ").concat(e," (").concat(s,"ms)"),d}},973:function(e,n,t){"use strict";var l;t.d(n,{J:function(){return i}});let i={outputDir:"out",authorApiBaseUrl:null!==(l=t(357).env.NEXT_PUBLIC_AUTHOR_API_BASE_URL)&&void 0!==l?l:"http://localhost:4001",defaultThemeId:1}}},function(e){e.O(0,[892,999,971,23,744],function(){return e(e.s=8960)}),_N_E=e.O()}]);